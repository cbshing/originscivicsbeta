namespace = origins_civics_empire_setup
# by cbshing

### Hidden Game Start Event
# Handles setup of civics
# Handles setup of each civic in various subsections
# Handles by galaxy changes, cluster changes, system changes, colony setup, pop setup, planet setup, relationships setup, quest setup

# Handles setup of civics that require modifications to the galaxy
# -None at the moment
country_event = {
	id = origins_civics_empire_setup.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		oc_requires_galaxy_setup = yes
	}
	
	immediate = {
		
	}
}

# Handles setup of civics that require modifications to the galatic cluster
# -Requires Cluster Isolation
# ->N-Cluster
# -Requires Advanced Start
# ->Sublight Empire
# ->Sublight Conqueror
# -Requires Hostile Neighbors
# ->?
country_event = {
	id = origins_civics_empire_setup.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		oc_requires_cluster_setup = yes
	}
	
	immediate = {
		if = {
			limit = { oc_requires_isolate_cluster = yes }
			
		}
		if = {
			limit = { oc_requires_advanced_start = yes }
			# tags neighboring planets for future setup in planet setup
			# sets country as owner of planets
		}
		if = {
			limit = { oc_requires_hostile_neighbors = yes }
			
		}
	}
}

# Handles setup of civics that require modifications to the star system
# Does not change homeworld planet type
# -Requires Star Isolation
# ->Dyson Engineers
# -Requires Megastructures (Habitats, Dyson Sphere, Gateways, Sentry Array, Science Nexus)
# ->Voidborne
# ->Dyson Engineers
# -Requires Galactic Feature (Wormhole)
# ->Wormhole Travelers
# -Requires Star Class Modification
# ->Worm Loved
# -Requires Second Habitable Planet Creation
# ->Voidborne
# ->Post War of the Worlds
country_event = {
	id = origins_civics_empire_setup.3
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		oc_requires_solar_system_setup = yes
	}
	
	immediate = {	
		# isolate star system
		if = { limit = { oc_requires_isolate_star = yes } 
			capital_scope.solar_system = { # scope to capital system
				isolate_system = yes
			}
		}	
			
		# setup megastructures
		if = { limit = { oc_requires_megastruture_dyson_sphere = yes }  
			capital_scope.solar_system = { # scope to capital system
				random_system_planet = { # remove mining stations & deposits around primary star (if multi-star system)
					limit = { is_star = yes is_primary_star = yes }
					clear_deposits_and_stations = yes
					this = { save_event_target_as = megastructure_star }
					# tier 1 custom oc dyson sphere
				}
				if = { limit = { oc_requires_megastruture_dyson_sphere_tier2 = yes } 
					spawn_megastructure_oc_dyson_sphere_tier2 = yes
				}
				# tier 5 custom oc dyson sphere
				if = { limit = { oc_requires_megastruture_dyson_sphere_tier5 = yes } 
					spawn_megastructure_oc_dyson_sphere_tier5 = yes
				}
			}
		}
		
		if = { limit = { oc_requires_megastruture_habitat = yes } 
			if = { limit = { oc_requires_megastruture_habitat_over_homeworld = yes }  
				capital_scope.solar_system = { # scope to capital system
					random_system_planet = { # scope to homeworld planet
						limit = { is_capital = yes }
						set_planet_flag = "oc_old_habitat_capital"
						this = { save_event_target_as = megastructure_planet }
					}
					spawn_megastructure_habitat = yes
					random_system_planet ={
						limit = { is_planet_class = pc_habitat }
						set_owner = ROOT
						set_capital = yes
					}
				}
			}
			else = {
				capital_scope.solar_system = { # scope to capital system
					random_system_planet = { # scope to random planet not homeworld
						limit = { is_a_planet = yes has_owner = no }
						this = { save_event_target_as = megastructure_planet }
					}
					spawn_megastructure_habitat = yes
					random_system_planet ={
						limit = { is_planet_class = pc_habitat }
						set_owner = ROOT
						set_capital = yes
					}
				}
			}
		}
		
		if = { limit = { oc_requires_megastruture_gateway = yes } 
			if = { limit = { oc_requires_megastruture_gateway_ruined = yes } 
				capital_scope.solar_system = { # scope to capital system
					spawn_megastructure_gateway_ruined = yes
				}
			}
			
			if = { limit = { oc_requires_megastruture_gateway_construction = yes } 
				capital_scope.solar_system = { # scope to capital system
					spawn_megastructure_gateway_construction = yes
				}
			}
			
			if = { limit = { oc_requires_megastruture_gateway_complete = yes } 
				capital_scope.solar_system = { # scope to capital system
					spawn_megastructure_gateway_complete = yes
					activate_megastructure_random_gateway = yes
				}
			}
		}
		
		if = { limit = { oc_requires_megastruture_l_gate = yes } 
			capital_scope.solar_system = { # scope to capital system
				spawn_megastructure_l_gateway = yes
			}
		}
		
		if = { limit = { oc_requires_megastruture_sentry_array = yes } 
			capital_scope.solar_system = { # scope to capital system
				random_system_planet = { # scope to random planet not homeworld
					limit = { is_a_planet = yes has_owner = no }
					this = { save_event_target_as = megastructure_planet }
				}
				#spawn_megastructure_sentry_array_tier2 = yes
			}
		}
		
		if = { limit = { oc_requires_megastruture_science_nexus = yes } 
			capital_scope.solar_system = { # scope to capital system
				random_system_planet = { # scope to random planet not homeworld
					limit = { is_a_planet = yes has_owner = no }
					this = { save_event_target_as = megastructure_planet }
				}
				#spawn_megastructure_science_nexus_tier2 = yes
			}
		}
		
		# setup galactic system features
		if = { limit = { oc_requires_natural_wormhole = yes }
			capital_scope.solar_system = { # scope to capital system
				spawn_linked_natural_wormhole = yes
			}
		}	
		
		if = { limit = { oc_requires_star_class_to_change = yes }
			capital_scope.solar_system = { # scope to capital system
				random_system_planet = { # remove mining stations & deposits around primary star (if multi-star system)
					limit = { is_star = yes is_primary_star = yes }
					clear_deposits_and_stations = yes
					if = { limit = { oc_requires_star_class_change_to_blackhole = yes }
						change_pc = pc_black_hole
					}
				}
			}
		}
		
		# setup secondary planets in system
		if = { limit = { oc_requires_second_habitable_planet = yes }
			capital_scope.solar_system = { # scope to capital system
				random_system_planet = {
					limit = { is_a_planet = yes has_owner = no planet_size > 7 planet_size < 20 }
					set_planet_flag = oc_second_homeworld_planet
					set_owner = ROOT
					change_to_pc_owner_class = yes
				}
			}
		}
		
		if = { limit = { oc_requires_all_planets_habitable = yes }
			capital_scope.solar_system = { # scope to capital system
				every_system_planet = { # scope to every random planet not homeworld
					limit = { is_a_planet = yes has_owner = no } 
					if = { limit = { oc_requires_homeworld_class_to_change_to_nuked = yes }
						change_to_pc_nuked = yes
					}
				}
			}
		}
	}
}

# Handles setup of civics that require making the empire a colony of another empire
# -Find an empire with the same species and pair that empire up
# ->Lost Colony
# -Change the homeworld of the species to match that of a paired species
country_event = {
	id = origins_civics_empire_setup.4
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		oc_requires_colony_setup = yes
		NOR = { 
			has_country_flag = oc_homeworld_set 
			has_country_flag = oc_home_empire 
		}
	}
	
	immediate = {		
		#flag owner species to compare
		owner_species = { save_event_target_as = oc_colony_species }
		if = { limit = { oc_requires_secondary_species_colony_setup = yes }
			random_owned_pop = { limit = { NOT = { is_same_species = owner } }
				save_event_target_as = oc_colony_species 
			}
		}
		if = { limit = { oc_is_fallen_colonies_country = yes }
			# make fallen empires setup
			
		}
		#make lost colony
		if = {
			limit = {
				any_country = { 
					oc_requires_colony_setup = no
					any_owned_pop = { is_same_species = event_target:oc_colony_species }
				}
			}
			# home country
			every_country = {
				limit = { 
					oc_requires_colony_setup = no
					any_owned_pop = { is_same_species = event_target:oc_colony_species }
				}
				set_country_flag = oc_home_empire
				oc_set_colony_homeworld_flag = yes
				oc_create_colony_species = yes
				oc_change_pops_and_leaders_to_new_species = yes
				if = {
					limit = { owner_species = { is_same_species = event_target:oc_colony_species } }
					change_dominant_species = { species = last_created }
				}
				# every colony country
				every_country = {
					limit = { 
						oc_requires_colony_setup = yes
						OR = {
							is_same_species = event_target:oc_colony_species
							AND = {
								oc_requires_secondary_species_colony_setup = yes
								any_owned_pop = { is_same_species = event_target:oc_colony_species }
							}
						}
						NOT = { has_country_flag = oc_homeworld_set }
					}
					set_country_flag = oc_homeworld_set
					oc_set_colony_flag = yes
					oc_change_pops_and_leaders_to_new_species = yes
					if = {
						limit = { owner_species = { is_same_species = event_target:oc_colony_species } }
						change_dominant_species = { species = last_created }
					}
				}
			}
		}
		else_if = {
			limit = {
				oc_is_fallen_colonies_country = yes
				any_country = { # only for fallen colonies setup
					is_country_type = fallen_empire
				}
			}
			set_country_flag = oc_found_viable_homeworld
		}
	}
}

# Handles setup of civics that require modifications of the species
# -Requires species have a new homeworld type
# ->Voidborne
# ->Nuclear Mutation
# ->Colonies of Man
# -Requires species to have a special trait
# ->Cybernetic
# ->Latent Psionic
# ->Synthetic
# ->Psionic
# ->Brain Slug
# -Requires species to have a different homeworld
# ->Colonies of Earth
# ->Colonies of Man
country_event = {
	id = origins_civics_empire_setup.5
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		oc_requires_species_setup = yes
	}
	
	immediate = {
		# change primary species homeworld type
		if = { limit = { oc_requires_homeworld_preference_to_change = yes } 
			if = { limit = { oc_requires_habitat_preference = yes } 
				owner_species = { save_event_target_as = species_to_modify }
				make_species_habitat_preference = yes
				change_dominant_species = { species = last_created change_all = yes }
				if = { limit = { oc_requires_new_homeworld_is_habitat = yes }
					set_capital_as_homeworld = yes
				}
			}
			if = { limit = { oc_requires_gaia_preference = yes } 
				owner_species = { save_event_target_as = species_to_modify }
				make_species_gaia_preference = yes
				change_dominant_species = { species = last_created change_all = yes }
			}
			if = { limit = { oc_requires_nuked_preference = yes } 
				owner_species = { save_event_target_as = species_to_modify }
				make_species_nuked_preference = yes
				change_dominant_species = { species = last_created change_all = yes }
			}
			if = { limit = { oc_requires_continental_preference = yes } 
				owner_species = { save_event_target_as = species_to_modify }
				make_species_continental_preference = yes
				change_dominant_species = { species = last_created change_all = yes }
				
			}
			if = { 
				limit = { 
					oc_requires_ringworld_preference = yes 
					any_owned_planet = { is_capital = yes is_planet_class = pc_ringworld_habitable }
				} 
				owner_species = { save_event_target_as = species_to_modify }
				make_species_ringworld_preference = yes
				change_dominant_species = { species = last_created change_all = yes }
			}
		}
		# change secondary species homeworld type
		if = { 
			limit = { 
				oc_requires_secondary_species_preference_change = yes 
				OR = {
					oc_is_habitat_country = yes
					oc_is_gaia_country = yes
					oc_is_nuked_country = yes
					oc_is_ringworld_country = yes
					has_authority = auth_machine_intelligence
				}
			} 
			if = { limit = { oc_is_habitat_country = yes } 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				make_species_habitat_preference = yes
				set_capital_as_homeworld = yes
			}
			if = { limit = { oc_is_gaia_country = yes } 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				make_species_gaia_preference = yes
				set_capital_as_homeworld = yes
			}
			if = { limit = { oc_is_nuked_country = yes } 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				make_species_nuked_preference = yes
				set_capital_as_homeworld = yes
			}
			if = { 
				limit = { 
					oc_is_ringworld_country = yes 
					any_owned_planet = { is_capital = yes is_planet_class = pc_ringworld_habitable }
				} 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				make_species_ringworld_preference = yes
				set_capital_as_homeworld = yes
			}
		}
		
		# add new trait to species
		if = { limit = { oc_requires_species_have_new_trait = yes } 
			if = { limit = { oc_has_cybernetic_species_trait = yes } 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				mod_species_cybernetic = yes
			}
			if = { limit = { oc_has_latent_psionic_species_trait = yes } 
				# only impacts leaders, so see origins_civics_empire_setup.8
			}
			if = { limit = { oc_has_synthetic_species_trait = yes } 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				mod_species_synthetic = yes
			}
			if = { limit = { oc_has_psionic_species_trait = yes } 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				mod_species_psionic = yes
			}
			if = { limit = { oc_has_brain_slug_species_trait = yes } 
				random_owned_pop = { 
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				mod_species_brain_slug = yes
			}
		}
		
		# change species homeworld location
		if = { limit = { oc_requires_new_homeworld = yes }

			if = { limit = { oc_requires_new_homeworld_is_secondary_planet = yes } 
				capital_scope.solar_system = { # scope to capital system
					random_system_planet = {
						limit = { has_planet_flag = oc_second_homeworld_planet }
						this = { save_event_target_as = new_homeworld }
					}
				}
				random_owned_pop = { # only for secondary pop
					limit = { NOT = { is_same_species = owner_species } }
					this = { save_event_target_as = species_to_modify }
				}
				set_new_planet_as_homeworld = yes
			}
			if = { limit = { oc_is_from_earth = yes } # only for owner species
				capital_scope.solar_system = { # scope to capital system
					random_system_planet = {
						limit = { has_planet_flag = planet_earth }
						this = { save_event_target_as = new_homeworld }
					}
				}
				owner_species = { save_event_target_as = species_to_modify }
				set_new_planet_as_homeworld = yes
			}
			if = { limit = { oc_is_same_species_as_earth = yes } 
				owner_species = { save_event_target_as = species_to_modify }
				make_same_species_as_earth = yes
				set_country_flag = oc_homeworld_set
				oc_set_colony_flag = yes
			}
		}
	}
}

# Planet
# -Requires Homeworld Class Modification
# ->Nuclear Vault
# ->Nuclear Mutation
# ->Robo Nuclear Start
# -Resets Buildings and Blockers on Planets
# ->Generic Empire
# ->Hive Empire
# ->Machine Empire
# -Adds Special Buildings and Blockers to Planets
# -Setup Colony Homeworld
country_event = {
	id = origins_civics_empire_setup.6
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		oc_requires_planet_setup = yes
	}
	
	immediate = {
		if = { limit = { oc_requires_planet_size_change = yes }
			if = { limit = { oc_requires_planet_size_change_to_25 = yes }
				set_planet_size = 25
			}
			if = { limit = { oc_requires_planet_size_change_to_12 = yes }
				set_planet_size = 12
			}
			if = { limit = { oc_requires_planet_size_change_to_8 = yes }
				set_planet_size = 8
			}
			if = { limit = { oc_requires_planet_size_change_to_6 = yes }
				set_planet_size = 6
			}
			if = { limit = { oc_requires_planet_size_change_to_4 = yes }
				set_planet_size = 4
			}
		}		
		
		if = { limit = { oc_requires_homeworld_class_to_change = yes }
			if = { limit = { oc_requires_homeworld_class_to_change_to_random_habitable = yes }
				random_owned_planet = {
					limit = { is_capital = yes }
					change_to_pc_random_habitable = yes
					reset_start_buildings = yes
					reset_blockers = yes
					add_pops_on_planet = yes
				}
			}
			if = { limit = { oc_requires_homeworld_class_to_change_to_nuked = yes }
				random_owned_planet = {
					limit = { is_capital = yes }
					change_to_pc_nuked = yes
					reset_start_buildings = yes
					reset_blockers = yes
					add_pops_on_planet = yes
				}
			}
			if = { limit = { oc_requires_homeworld_class_to_change_to_gaia = yes }
				random_owned_planet = {
					limit = { is_capital = yes }
					change_to_pc_gaia = yes
					reset_start_buildings = yes
					reset_blockers = yes
					add_pops_on_planet = yes
				}
			}
			if = { limit = { oc_requires_homeworld_class_to_change_to_machine = yes }
				random_owned_planet = {
					limit = { is_capital = yes }
					change_to_pc_machine = yes
					reset_start_buildings = yes
					reset_blockers = yes
					add_pops_on_planet = yes
				}
			}
			if = { limit = { oc_requires_homeworld_class_to_change_to_city = yes }
				random_owned_planet = {
					limit = { is_capital = yes }
					change_to_pc_city = yes
					reset_start_buildings = yes
					reset_blockers = yes
					add_pops_on_planet = yes
				}
			}
		}		
		if = { limit = { oc_requires_habitat_setup = yes } 
			every_planet_within_border = {
				limit = { is_planet_class = pc_habitat  NOT = { has_planet_flag = advanced_colony } }
				reset_start_buildings = yes
				reset_blockers = yes
				add_pops_on_planet = yes
			}
			every_planet_within_border = {
				limit = { is_planet_class = pc_habitat  has_planet_flag = advanced_colony }
				reset_colony_start_buildings = yes
				reset_blockers = yes
				add_advanced_colony_pops_on_planet = yes
			}
		}
		if = { limit = { oc_requires_ringworld_setup = yes } 
			random_owned_planet = {
				limit = { is_capital = yes is_planet_class = pc_ringworld_habitable }
				reset_start_buildings = yes
				reset_blockers = yes
				add_pops_on_planet = yes
			}
		}
		if = { limit = { oc_requires_reset_blockers_setup = yes } 
			every_planet_within_border = {
				limit = { NOT = { has_planet_flag = advanced_colony } NOT = { is_capital = yes } }
				reset_blockers = yes
			}
		}		
		if = { limit = { oc_requires_additional_blockers_setup = yes } 
			every_planet_within_border = {
				limit = { NOT = { has_planet_flag = advanced_colony } }
				add_additional_blockers = yes
			}
		}
		
		# Destroy original homeworld
		
		# Destroy every colony except capital
	}
}

# Pop

# Leaders

# Ships

# Technologies

# Flags

# Quests
