namespace = origins_civics_galaxy_setup
# by cbshing

### Hidden Game Start Event
# Generates or setups galactic features including:
#  - Sol System
#  - NPC Fallen Colony
#  - NPC Primitive Lost Colony
#  - NPC Primitive Fallen Colony
#  - Ring of Gaia system
#  - Fallen Graveyard
#  - Fallen Patrol
#  - 

###  - Extrasolar home system (Lost/Exiled Colony, Refugee)
#  -Slow Zone bonus ystem
#  -Ring of Gaia bonus system

# Create Sol System if missing
# Runs prior to event game_start.1 to force Origins Civics' custom "sol_system"s to replace "com_sol_system" spawning
event = {
	id = origins_civics_galaxy_setup.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = sol_system_exists }
	}
	
	immediate = {
		if = {
			limit = { any_country = { oc_requires_npc_sol = yes } }
			if = {
				limit = { oc_requires_default_npc_sol = yes }
				random_system = { spawn_system = { initializer = "origins_npc_sol_system" } }
				random_list = {
					90 = { create_human_une_empire = yes }
					10 = { create_human_hte_empire = yes }
				}
				default_empire_setup = yes
			}
			else_if = {
				limit = { oc_requires_primitive_early_space_age_sol = yes }
				random_system = { spawn_system = { initializer = "origins_npc_sol_system" } }
			}
			else_if = {
				limit = { oc_requires_nuked_sol = yes }
				random_system = { spawn_system = { initializer = "special_init_04" } }
				set_global_flag = earth_was_nuked
			}
			else = { # random sol
			random_list = {
					50 = { # random primitive Earth
						random_system = { spawn_system = { initializer = "special_init_03" } } 
					} 
					30 = { # random OC default Earth (UNE or HTE)
						random_system = { spawn_system = { initializer = "origins_npc_sol_system" } }
						random_list = {
							90 = { create_human_une_empire = yes }
							10 = { create_human_hte_empire = yes }
						}
						default_empire_setup = yes
					} 
					10 = { # random tomb world Earth
						random_system = { spawn_system = { initializer = "special_init_04" } } 
					}  
					10 = { # fallen tomb world Earth
						random_system = { spawn_system = { initializer = "origins_npc_sol_system" } }
						random_planet = { limit = { has_planet_flag = planet_earth }
							change_to_pc_nuked = yes
							spawn_fallen_empire_debris = yes
						}
					} 
				}
			}
			set_global_flag = sol_system_exists
		}
	}
}

# Add Fallen Empire Abandoned Colonies Modifier
event = {
	id = origins_civics_galaxy_setup.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_country = {
			OR = {
				is_country_type = fallen_empire
				is_country_type = awakened_empire
			}
			NOT = { has_authority = auth_machine_intelligence }
		}
	}
	
	immediate = {
		every_country = {
			limit = { is_country_type = fallen_empire NOT = { has_authority = auth_machine_intelligence } }
			every_system_within_border = {
				every_neighbor_system = { 
					ignore_hyperlanes = no 
					limit = { has_owner = no NOT = { has_star_flag = empire_cluster } }
					random_system_planet = {
						limit = { is_a_planet = yes }
						random_list = {
							50 = { add_modifier = { modifier = pm_oc_abandoned_colony days = -1 } }
							50 = { }
						}
					}
				}
			}
		}
	}
}